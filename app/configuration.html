<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Kyte - Shipyard</title>
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/assets/css/kyte-form.css">
    <link rel="stylesheet" href="/assets/css/kyte-shipyard-common.css">
    <!--  -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Nunito:wght@200;500;700&display=swap" rel="stylesheet">
    <!-- javascripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js" integrity="sha256-hlKLmzaRlE8SCJC1Kw8zoUbU8BxA+8kR3gseuKfMjxA=" crossorigin="anonymous"></script>
    <!-- JavaScript obfuscator -->
    <script src="https://cdn.jsdelivr.net/npm/javascript-obfuscator/dist/index.browser.js"></script>
    <!-- Kyte -->
    <script>
        // Auto-detect localhost and conditionally load local kyte.js for development
        (function() {
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

            // Load kyte.js: use local dev version on localhost, otherwise use CDN
            const kyteScript = isLocalhost ? '/assets/js/kyte-dev.js' : 'https://cdn.keyqcloud.com/kyte/js/stable/kyte.js';
            document.write('<script src="' + kyteScript + '"' + (isLocalhost ? '' : ' crossorigin="anonymous"') + '><\/script>');

            if (isLocalhost) {
                console.log('%c[DEV MODE] Loading local kyte-api-js from /assets/js/kyte-dev.js', 'color: #FF6B6B; font-weight: bold;');
            }
        })();
    </script>
    <script>
        // Auto-detect localhost and load non-obfuscated source files for development
        (function() {
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const jsPath = isLocalhost ? '/assets/js/source/' : '/assets/js/';

            const scripts = [
                'kyte-i18n.js',
                'kyte-shipyard.js',
                'navigation.js',
                'kyte-shipyard-tables.js',
                'kyte-shipyard-application-configuration.js',
                'kyte-shipyard-ai-error-correction.js'
            ];

            scripts.forEach(function(script) {
                document.write('<script src="' + jsPath + script + '"><\/script>');
            });

            if (isLocalhost) {
                console.log('%c[DEV MODE] Loading non-obfuscated source files from ' + jsPath, 'color: #4CAF50; font-weight: bold;');
            }
        })();
    </script>

    <!-- Initialize i18n for authenticated pages -->
    <script>
        document.addEventListener('KyteInitialized', function(e) {
            const kyteI18n = new KyteI18n('en', '/assets/i18n/');

            // Make kyteI18n globally available for sidebar translation
            window.kyteI18n = kyteI18n;

            // Get user language from localStorage (stored during login)
            const cachedLanguage = localStorage.getItem('kyte_user_language');

            // Initialize with cached language or browser detection
            kyteI18n.init(cachedLanguage).then(() => {
                console.log('[i18n] Page initialized with language:', kyteI18n.getCurrentLanguage());
                kyteI18n.translateDOM();
            }).catch(error => {
                console.error('[i18n] Failed to initialize:', error);
            });
        });
    </script>

</head>

<body>
    <!-- Page loading modal -->
    <div id="pageLoaderModal" class="modal white" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-sm h-100 d-flex">
            <div class="mx-auto align-self-center" style="width: 48px">
                <div class="spinner-wrapper text-center fa-6x"><span class="fas fa-sync fa-spin"></span></div>
            </div>
        </div>
    </div>

    <div id="wrapper">
        <!-- START UNIFIED TOP NAV -->
        <nav id="application-nav" class="navbar navbar-dark navbar-expand-sm">
            <div class="container-fluid">
                <!-- Sidebar Toggle (Mobile) -->
                <button id="sidebar-toggle" aria-label="Toggle sidebar">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- Brand -->
                <a href="/app/" class="navbar-brand">
                    Kyte Shipyard<sup>™</sup>
                    <img src="/assets/images/kyte_shipyard_light.png" alt="Kyte Shipyard">
                </a>

                <!-- Center: App Selector (clickable to dashboard) -->
                <a href="#" id="app-selector" class="mx-auto">
                    <i class="fas fa-rocket"></i>
                    <span id="app-name">Application Dashboard</span>
                </a>

                <!-- Right: Account Dropdown -->
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle me-2"></i>Account
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="/app/settings.html"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item logout" href="#"><i class="fas fa-power-off me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- END UNIFIED TOP NAV -->

        <!-- Page Container with Sidebar -->
        <div id="page-container">
            <!-- Application Sidebar -->
            <aside id="app-sidebar">
                <!-- Sidebar content will be populated by JavaScript -->
            </aside>

            <!-- Sidebar Overlay for Mobile -->
            <div id="sidebar-overlay"></div>

            <!-- Main Content -->
            <main id="app-config-page-wrapper">
            <!-- BEGIN SIDE NAVIGATION -->
            <div id="sidenav" class="d-flex flex-column flex-shrink-0">
                <div class="sidebar-header">
                    <a href="#" id="back-to-app" class="sidebar-back-button mb-3">
                        <i class="fas fa-arrow-left"></i>
                        <span data-i18n="ui.config.back_to_app">Back to Application</span>
                    </a>
                    <h3 id="app-name" class="mb-2" data-i18n="ui.config.title">Application Configuration</h3>
                    <div class="app-subtitle" data-i18n="ui.config.subtitle">Manage your application settings</div>
                </div>

                <div class="sidebar-nav">
                    <div class="nav-section">
                        <div class="nav-section-title" data-i18n="ui.config.sidebar.title">Configuration</div>
                        <button class="nav-link active" data-section="App">
                            <i class="fas fa-cog"></i>
                            <span data-i18n="ui.config.sidebar.app_settings">App Settings</span>
                        </button>
                        <button class="nav-link" data-section="EnvironmentVars">
                            <i class="fas fa-code"></i>
                            <span data-i18n="ui.config.sidebar.env_vars">Environment Variables</span>
                        </button>
                        <button class="nav-link" data-section="KyteConnect">
                            <i class="fas fa-rocket"></i>
                            <span data-i18n="ui.config.sidebar.kyte_connect">Kyte Connect</span>
                        </button>
                        <button class="nav-link" data-section="AIErrorCorrection">
                            <i class="fas fa-robot"></i>
                            <span data-i18n="ui.config.sidebar.ai_error_correction">AI Error Correction</span>
                        </button>
                    </div>
                </div>
            </div>
            <!-- END SIDE NAVIGATION -->

            <div class="main-content">
                <!-- App Configuration Section -->
                <div id="App" class="content-section active">
                    <!-- User Table Configuration -->
                    <div class="config-card">
                        <div class="config-card-header">
                            <div class="config-card-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <h3 class="config-card-title" data-i18n="ui.config.user_table.title">User Table Configuration</h3>
                            </div>
                        </div>
                        <p class="config-card-description" data-i18n="ui.config.user_table.description">
                            Customize the user table for your web app. Specify the fields and attributes that define your users, such as name, email, and password. This allows you to tailor the user management system to fit your specific requirements.
                        </p>
                        <div class="form-grid-3">
                            <div class="form-group">
                                <label class="form-label" data-i18n="ui.config.user_table.user_model">User Model</label>
                                <select id="user_model" class="form-select">
                                    <option value="0" data-i18n="ui.config.user_table.user_model_default">Kyte Framework User (Default)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="ui.config.user_table.username_field">Login Username Field</label>
                                <select id="username_colname" class="form-select" disabled>
                                    <option value="" data-i18n="ui.config.user_table.loading">Loading...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="ui.config.user_table.password_field">Login Password Field</label>
                                <select id="password_colname" class="form-select" disabled>
                                    <option value="" data-i18n="ui.config.user_table.loading">Loading...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Application Language Configuration -->
                    <div class="config-card">
                        <div class="config-card-header">
                            <div class="config-card-icon">
                                <i class="fas fa-language"></i>
                            </div>
                            <div>
                                <h3 class="config-card-title" data-i18n="ui.config.language.title">Application Language</h3>
                            </div>
                        </div>
                        <p class="config-card-description" data-i18n="ui.config.language.description">
                            Set the default language for your application. This language will be used for all users who haven't set their own language preference.
                        </p>
                        <div class="form-group">
                            <label class="form-label" data-i18n="ui.config.language.label">Default Language</label>
                            <select id="app_default_language" class="form-select">
                                <option value="en">English</option>
                                <option value="ja">日本語 (Japanese)</option>
                                <option value="ko">한국어 (Korean)</option>
                                <option value="es">Español (Spanish)</option>
                            </select>
                            <div class="form-text mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                <span data-i18n="ui.config.language.supported">Supported Languages:</span> English, 日本語 (Japanese), 한국어 (Korean), Español (Spanish)
                            </div>
                        </div>
                        <div class="alert alert-info d-flex align-items-start mt-3" role="alert">
                            <i class="fas fa-info-circle me-2 mt-1"></i>
                            <div>
                                <strong data-i18n="ui.config.language.note">Note:</strong>
                                <span data-i18n="ui.config.language.note_text">Individual users can override this setting in their personal profile settings.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Organization Table Configuration -->
                    <div class="config-card">
                        <div class="config-card-header">
                            <div class="config-card-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div>
                                <h3 class="config-card-title" data-i18n="ui.config.org_table.title">Organization Table Configuration</h3>
                            </div>
                        </div>
                        <p class="config-card-description" data-i18n="ui.config.org_table.description">
                            Set up an organization table to manage users within specific groups or organizations. Define fields like organization name, description, and membership attributes to organize users and facilitate collaboration within your web app.
                        </p>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" data-i18n="ui.config.org_table.org_model">Organization Model</label>
                                <select id="org_model" class="form-select" disabled>
                                    <option value="0" id="default_org_model" data-i18n="ui.config.org_table.org_model_default">Kyte Framework Account (Default)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="ui.config.org_table.user_fk">User Foreign Key to Organization</label>
                                <select id="userorg_colname" class="form-select" disabled>
                                    <option value="" data-i18n="ui.config.user_table.loading">Loading...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- AWS Credentials -->
                    <div class="config-card">
                        <div class="config-card-header">
                            <div class="config-card-icon">
                                <i class="fab fa-aws"></i>
                            </div>
                            <div>
                                <h3 class="config-card-title" data-i18n="ui.config.aws.title">AWS Credentials</h3>
                            </div>
                        </div>
                        <p class="config-card-description" data-i18n="ui.config.aws.description">
                            AWS credentials configured for this application. These credentials are used for accessing AWS services required by your application.
                        </p>
                        <div class="aws-credentials-grid">
                            <div class="aws-field">
                                <label class="form-label" data-i18n="ui.config.aws.username">Username</label>
                                <input type="text" id="aws_username" class="form-control" readonly>
                            </div>
                            <div class="aws-field">
                                <label class="form-label" data-i18n="ui.config.aws.public_key">Public Key</label>
                                <input type="text" id="aws_public_key" class="form-control" readonly>
                            </div>
                            <div class="aws-field">
                                <label class="form-label" data-i18n="ui.config.aws.secret_key">Secret Key</label>
                                <div class="aws-secret-notice">
                                    <i class="fas fa-eye-slash"></i>
                                    <span data-i18n="ui.config.aws.secret_hidden">Secret key is not displayed for security</span>
                                </div>
                            </div>
                        </div>
                        <div class="security-notice">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong data-i18n="ui.config.aws.note">Note:</strong> <span data-i18n="ui.config.aws.note_text">Currently, changing AWS credentials for your application is not supported. If you need to change AWS credentials, please contact support.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="d-flex justify-content-end pb-3 pe-3">
                        <button id="saveAppSettings" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            <span data-i18n="ui.config.save_button">Save App Configuration</span>
                        </button>
                    </div>
                </div>

                <!-- Environment Variables Section -->
                <div id="EnvironmentVars" class="content-section">
                    <div class="section-header">
                        <h2 class="section-title" data-i18n="ui.config.env_vars.title">Environment Variables</h2>
                        <button class="btn-new" id="newEnvVar">
                            <i class="fas fa-plus"></i>
                            <span data-i18n="ui.config.env_vars.add_button">Add Variable</span>
                        </button>
                    </div>
                    <div class="section-content">
                        <div class="mb-4">
                            <p class="text-muted" data-i18n="ui.config.env_vars.description">
                                Manage your application's environment variables here. Add new variables, edit existing ones, or remove them as needed.
                                Ensure to follow the correct format and understand the impact of changes on your application's behavior.
                            </p>
                        </div>
                        <table id="tblEnvVars" class="table table-striped w-100"></table>
                    </div>
                </div>

                <!-- Kyte Connect Section -->
                <div id="KyteConnect" class="content-section">
                    <!-- Obfuscation Settings -->
                    <div class="config-card">
                        <div class="config-card-header">
                            <div class="config-card-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div>
                                <h3 class="config-card-title" data-i18n="ui.config.kyte_connect.obfuscation.title">Kyte Connect Obfuscation</h3>
                            </div>
                        </div>
                        <p class="config-card-description" data-i18n="ui.config.kyte_connect.obfuscation.description">
                            Control whether JavaScript for connecting to the Kyte API endpoint is obfuscated. Obfuscation is recommended for security, but if organizational policies (such as firewall requirements) prevent obfuscated code, you can disable it here.
                        </p>
                        <p class="config-card-description">
                            <br>
                            <strong data-i18n="ui.config.kyte_connect.obfuscation.important">Important:</strong> <span data-i18n="ui.config.kyte_connect.obfuscation.important_text">Changing this setting will automatically regenerate the Kyte Connect code and update all published pages with the new version. You can review the updated code in the "Kyte Connect Code Comparison" section below before it's applied.</span>
                        </p>
                        <div class="form-group">
                            <label class="form-label" data-i18n="ui.config.kyte_connect.obfuscation.setting">Obfuscation Setting</label>
                            <select id="obfuscate_kyte_connect" class="form-select">
                                <option value="1" data-i18n="ui.config.kyte_connect.obfuscation.enabled">Obfuscate (Recommended)</option>
                                <option value="0" data-i18n="ui.config.kyte_connect.obfuscation.disabled">Do Not Obfuscate (Not Recommended)</option>
                            </select>
                        </div>
                        <!-- Save Button -->
                        <div class="d-flex justify-content-end">
                            <button id="saveObfuscationSettings" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>
                                <span data-i18n="ui.config.kyte_connect.obfuscation.save_button">Save Obfuscation Settings</span>
                            </button>
                        </div>
                    </div>

                    <!-- Kyte Connect Configuration -->
                    <div class="config-card">
                        <div class="config-card-header">
                            <div class="config-card-icon">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div>
                                <h3 class="config-card-title" data-i18n="ui.config.kyte_connect.comparison.title">Kyte Connect Code Comparison</h3>
                            </div>
                        </div>
                        <p class="config-card-description" data-i18n="ui.config.kyte_connect.comparison.description">
                            Compare your current Kyte Connect JavaScript with the latest system version. Update your application to use the latest code when API endpoints or configurations change.
                        </p>

                        <!-- Version Status Banner -->
                        <div id="version-status-banner" class="version-status-banner">
                            <div class="status-indicator">
                                <i class="fas fa-sync-alt status-icon"></i>
                                <span class="status-text" data-i18n="ui.config.kyte_connect.comparison.checking">Checking versions...</span>
                            </div>
                        </div>

                        <!-- Code Comparison Container -->
                        <div class="code-comparison-container">
                            <!-- Current Version -->
                            <div class="code-panel current-version">
                                <div class="code-panel-header">
                                    <h4 class="code-panel-title">
                                        <i class="fas fa-file-code me-2"></i>
                                        <span data-i18n="ui.config.kyte_connect.comparison.current_version">Current Application Version</span>
                                    </h4>
                                    <div class="code-panel-info">
                                        <span class="version-badge current">
                                            <i class="fas fa-clock me-1"></i>
                                            <span id="current-version-date">Loading...</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="code-panel-content">
                                    <div class="code-wrapper">
                                        <pre id="current-kyte-code" class="code-block"><code data-i18n="ui.config.kyte_connect.comparison.loading_current">Loading current version...</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- System Version -->
                            <div class="code-panel system-version">
                                <div class="code-panel-header">
                                    <h4 class="code-panel-title">
                                        <i class="fas fa-cloud me-2"></i>
                                        <span data-i18n="ui.config.kyte_connect.comparison.system_version">Latest System Version</span>
                                    </h4>
                                    <div class="code-panel-info">
                                        <span class="version-badge system">
                                            <i class="fas fa-rocket me-1"></i>
                                            <span id="system-version-date">Loading...</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="code-panel-content">
                                    <div class="code-wrapper">
                                        <pre id="system-kyte-code" class="code-block"><code data-i18n="ui.config.kyte_connect.comparison.loading_system">Loading system version...</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="code-actions">
                            <button id="refresh-comparison" class="btn btn-secondary">
                                <i class="fas fa-sync-alt me-2"></i>
                                <span data-i18n="ui.config.kyte_connect.comparison.refresh">Refresh Comparison</span>
                            </button>
                            <button id="update-to-system" class="btn btn-primary" disabled>
                                <i class="fas fa-upload me-2"></i>
                                <span data-i18n="ui.config.kyte_connect.comparison.update">Update to System Version</span>
                            </button>
                            <button id="view-diff" class="btn btn-outline-info">
                                <i class="fas fa-search me-2"></i>
                                <span data-i18n="ui.config.kyte_connect.comparison.view_diff">View Detailed Diff</span>
                            </button>
                        </div>

                        <!-- Diff Modal Trigger (Hidden, will be shown when differences exist) -->
                        <div id="diff-summary" class="diff-summary" style="display: none;">
                            <div class="diff-stats">
                                <span class="diff-stat additions">
                                    <i class="fas fa-plus-circle"></i>
                                    <span id="additions-count">0</span> <span data-i18n="ui.config.kyte_connect.comparison.additions">additions</span>
                                </span>
                                <span class="diff-stat deletions">
                                    <i class="fas fa-minus-circle"></i>
                                    <span id="deletions-count">0</span> <span data-i18n="ui.config.kyte_connect.comparison.deletions">deletions</span>
                                </span>
                                <span class="diff-stat modifications">
                                    <i class="fas fa-edit"></i>
                                    <span id="modifications-count">0</span> <span data-i18n="ui.config.kyte_connect.comparison.modifications">modifications</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Error Correction Configuration Section -->
                <div id="AIErrorCorrection" class="content-section">
                    <!-- Loading State -->
                    <div id="ai-config-loading" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3" data-i18n="ui.config.ai_error.loading">Loading AI Error Correction Configuration...</p>
                    </div>

                    <!-- Configuration Form -->
                    <div id="ai-config-form" style="display: none;">
                        <!-- Status Header -->
                        <div class="config-card">
                            <div class="config-card-header">
                                <div class="config-card-icon">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h3 class="config-card-title" data-i18n="ui.config.ai_error.status_title">AI Error Correction Status</h3>
                                    <div id="ai-config-status" class="mt-2">
                                        <span class="badge bg-secondary" data-i18n="ui.config.ai_error.loading">Loading...</span>
                                    </div>
                                </div>
                                <div>
                                    <button id="ai-quick-enable-btn" class="btn btn-success me-2">
                                        <i class="fas fa-power-off"></i> <span data-i18n="ui.config.ai_error.quick_enable">Quick Enable</span>
                                    </button>
                                    <button id="ai-quick-disable-btn" class="btn btn-danger">
                                        <i class="fas fa-power-off"></i> <span data-i18n="ui.config.ai_error.quick_disable">Quick Disable</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div class="config-card">
                            <div class="config-card-header">
                                <div class="config-card-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div>
                                    <h3 class="config-card-title" data-i18n="ui.config.ai_error.statistics">Statistics</h3>
                                </div>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="stat-value" id="ai-stats-total-analyses">0</div>
                                        <div class="stat-label" data-i18n="ui.config.ai_error.total_analyses">Total Analyses</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="stat-value" id="ai-stats-fixes-applied">0</div>
                                        <div class="stat-label" data-i18n="ui.config.ai_error.fixes_applied">Fixes Applied</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="stat-value" id="ai-stats-success-rate">0</div>
                                        <div class="stat-label" data-i18n="ui.config.ai_error.success_rate">Success Rate (%)</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="stat-value" id="ai-stats-total-cost">$0.00</div>
                                        <div class="stat-label">
                                            <span data-i18n="ui.config.ai_error.estimated_cost">Estimated Cost</span>
                                            <i class="fas fa-info-circle"
                                               style="cursor: help; opacity: 0.8;"
                                               data-bs-toggle="tooltip"
                                               data-bs-placement="top"
                                               data-i18n-title="ui.config.ai_error.estimated_cost_tooltip"
                                               title="This is an estimated cost based on token usage. AWS Bedrock pricing may vary. Please check your AWS Billing Console for actual costs."></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end mt-3">
                                <button id="ai-reset-stats-btn" class="btn btn-outline-danger">
                                    <i class="fas fa-undo"></i> <span data-i18n="ui.config.ai_error.reset_statistics">Reset Statistics</span>
                                </button>
                            </div>
                        </div>

                        <!-- Feature Settings -->
                        <div class="config-card">
                            <div class="config-card-header">
                                <div class="config-card-icon">
                                    <i class="fas fa-toggle-on"></i>
                                </div>
                                <div>
                                    <h3 class="config-card-title" data-i18n="ui.config.ai_error.feature_settings">Feature Settings</h3>
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="ai-enabled">
                                    <label class="form-check-label" for="ai-enabled">
                                        <strong data-i18n="ui.config.ai_error.enable_ai">Enable AI Error Correction</strong>
                                        <small class="d-block text-muted" data-i18n="ui.config.ai_error.enable_ai_desc">Master toggle for the entire system</small>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="ai-auto-fix-enabled">
                                    <label class="form-check-label" for="ai-auto-fix-enabled">
                                        <strong data-i18n="ui.config.ai_error.enable_auto_fix">Enable Auto-Fix Mode</strong>
                                        <small class="d-block text-muted" data-i18n="ui.config.ai_error.enable_auto_fix_desc">Automatically apply high-confidence fixes (default: suggest only)</small>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><span data-i18n="ui.config.ai_error.min_confidence">Minimum Confidence for Auto-Fix</span>: <span id="ai-min-confidence-value">90</span>%</label>
                                <input type="range" class="form-range" id="ai-min-confidence" min="0" max="100" step="5" value="90">
                                <small class="form-text text-muted" data-i18n="ui.config.ai_error.min_confidence_desc">Only fixes with confidence above this threshold will be auto-applied</small>
                            </div>
                        </div>

                        <!-- Rate Limiting & Cost Control -->
                        <div class="config-card">
                            <div class="config-card-header">
                                <div class="config-card-icon">
                                    <i class="fas fa-tachometer-alt"></i>
                                </div>
                                <div>
                                    <h3 class="config-card-title" data-i18n="ui.config.ai_error.rate_limiting">Rate Limiting & Cost Control</h3>
                                </div>
                            </div>
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.max_per_hour">Max Analyses Per Hour</label>
                                    <input type="number" class="form-control" id="ai-max-per-hour" min="1" max="100" value="10">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.max_per_day">Max Analyses Per Day</label>
                                    <input type="number" class="form-control" id="ai-max-per-day" min="1" max="1000" value="50">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.max_monthly_cost">Max Monthly Cost (USD)</label>
                                    <input type="number" class="form-control" id="ai-max-monthly-cost" min="0" step="10" value="100">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.cooldown_period">Cooldown Period (minutes)</label>
                                    <input type="number" class="form-control" id="ai-cooldown-minutes" min="0" max="1440" value="30">
                                    <small class="form-text text-muted" data-i18n="ui.config.ai_error.cooldown_period_desc">Wait time before re-analyzing same error</small>
                                </div>
                            </div>
                        </div>

                        <!-- Loop Detection -->
                        <div class="config-card">
                            <div class="config-card-header">
                                <div class="config-card-icon">
                                    <i class="fas fa-sync"></i>
                                </div>
                                <div>
                                    <h3 class="config-card-title" data-i18n="ui.config.ai_error.loop_detection">Loop Detection</h3>
                                </div>
                            </div>
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.max_fix_attempts">Max Fix Attempts</label>
                                    <input type="number" class="form-control" id="ai-max-attempts" min="1" max="20" value="5">
                                    <small class="form-text text-muted" data-i18n="ui.config.ai_error.max_fix_attempts_desc">Max consecutive fixes before disabling</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.loop_window">Loop Detection Window (minutes)</label>
                                    <input type="number" class="form-control" id="ai-loop-window" min="1" max="1440" value="60">
                                    <small class="form-text text-muted" data-i18n="ui.config.ai_error.loop_window_desc">Time window for detecting recurring errors</small>
                                </div>
                            </div>
                            <div class="form-group mt-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="ai-auto-disable-loop" checked>
                                    <label class="form-check-label" for="ai-auto-disable-loop">
                                        <strong data-i18n="ui.config.ai_error.auto_disable_loop">Auto-disable on Loop Detection</strong>
                                        <small class="d-block text-muted" data-i18n="ui.config.ai_error.auto_disable_loop_desc">Automatically disable auto-fix when infinite loop detected</small>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Batch Processing -->
                        <div class="config-card">
                            <div class="config-card-header">
                                <div class="config-card-icon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <div>
                                    <h3 class="config-card-title" data-i18n="ui.config.ai_error.batch_processing">Batch Processing</h3>
                                </div>
                            </div>
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.batch_size">Batch Size</label>
                                    <input type="number" class="form-control" id="ai-batch-size" min="1" max="100" value="10">
                                    <small class="form-text text-muted" data-i18n="ui.config.ai_error.batch_size_desc">Max analyses per cron job run</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="ui.config.ai_error.max_concurrent">Max Concurrent API Calls</label>
                                    <input type="number" class="form-control" id="ai-max-concurrent" min="1" max="10" value="3">
                                    <small class="form-text text-muted" data-i18n="ui.config.ai_error.max_concurrent_desc">Parallel Bedrock API calls</small>
                                </div>
                            </div>
                        </div>

                        <!-- Analysis Preferences -->
                        <div class="config-card">
                            <div class="config-card-header">
                                <div class="config-card-icon">
                                    <i class="fas fa-sliders-h"></i>
                                </div>
                                <div>
                                    <h3 class="config-card-title" data-i18n="ui.config.ai_error.analysis_preferences">Analysis Preferences</h3>
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ai-include-warnings">
                                    <label class="form-check-label" for="ai-include-warnings" data-i18n="ui.config.ai_error.include_warnings">
                                        Include Warnings (not just errors)
                                    </label>
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ai-include-models" checked>
                                    <label class="form-check-label" for="ai-include-models" data-i18n="ui.config.ai_error.include_models">
                                        Include Model Definitions in Context
                                    </label>
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ai-include-request" checked>
                                    <label class="form-check-label" for="ai-include-request" data-i18n="ui.config.ai_error.include_request">
                                        Include Request Data in Context
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ai-include-framework" checked>
                                    <label class="form-check-label" for="ai-include-framework" data-i18n="ui.config.ai_error.include_framework">
                                        Include Framework Documentation
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Save Button -->
                        <div class="d-flex justify-content-end">
                            <button id="ai-save-config-btn" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> <span data-i18n="ui.config.ai_error.save_config">Save Configuration</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content d-flex justify-content-between align-items-center">
            <div class="footer-versions">
                <div>Kyte Shipyard™ Version <span id="kyteShipyardVersion"></span></div>
                <div>Kyte JS Version <span id="kyteJSVersion"></span></div>
            </div>
            <p class="footer-copyright mb-0">KeyQ © 2020-2026</p>
        </div>
    </footer>

    <!-- modal form -->
    <div id="modalForm"></div>

    <script>
        // Navigation handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Get the application ID from localStorage (set by kyte-shipyard-application-configuration.js)
            function getDashboardUrl() {
                const appId = localStorage.getItem('currentAppId');
                if (appId) {
                    const dashboardRequest = btoa(JSON.stringify({'model': 'Application', 'idx': parseInt(appId)}));
                    return '/app/dashboard/?request=' + encodeURIComponent(dashboardRequest);
                }
                return '/app/';
            }

            // Back button handler (goes to dashboard)
            const backBtn = document.getElementById('back-to-app');
            if (backBtn) {
                backBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.location.href = getDashboardUrl();
                });
            }

            // App selector (dashboard link)
            const appSelector = document.getElementById('app-selector');
            if (appSelector) {
                appSelector.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.location.href = getDashboardUrl();
                });
            }
        });
    </script>
</body>
</html>